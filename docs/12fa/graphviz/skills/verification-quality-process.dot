digraph VERIFICATION_QUALITY_WORKFLOW {
  // Layout configuration
  rankdir=TB;
  node [shape=box, style="rounded,filled"];

  // =============================================================================
  // INITIALIZATION PHASE
  // =============================================================================
  subgraph cluster_initialization {
    label="Quality Verification Initialization";
    style="filled,rounded";
    color="lightblue";
    bgcolor="#E8F4F8";

    start [label="Quality Check Invoked", shape=ellipse, fillcolor=lightblue];
    load_spec [label="Load Quality Standards"];
    validate_input [label="Validate Target Files/Modules"];
    check_deps [label="Check Testing Dependencies"];

    start -> load_spec;
    load_spec -> validate_input;
    validate_input -> check_deps;
  }

  // =============================================================================
  // VALIDATION & POLICY ENFORCEMENT
  // =============================================================================
  subgraph cluster_validation {
    label="Policy Validation";
    style="filled,rounded";
    color="orange";
    bgcolor="#FFF8E8";

    check_policy [shape=diamond, label="12-FA\nCompliant?"];
    check_secrets [shape=diamond, label="No Secrets\nin Root?"];
    validate_standards [shape=diamond, label="Quality Standards\nDefined?"];

    policy_violation [shape=octagon, fillcolor=crimson,
                      label="BLOCKED\nPolicy Violation"];
    secrets_violation [shape=octagon, fillcolor=crimson,
                       label="BLOCKED\nRule #1: No Secrets in Root"];
    standards_missing [shape=octagon, fillcolor=orange,
                       label="WARN\nQuality Standards Missing"];
  }

  // Connect initialization to validation
  check_deps -> check_policy;
  check_policy -> check_secrets [label="Pass"];
  check_policy -> policy_violation [label="Fail"];
  check_secrets -> validate_standards [label="Pass"];
  check_secrets -> secrets_violation [label="Secrets Found"];
  validate_standards -> standards_missing [label="Missing"];

  // =============================================================================
  // EXECUTION PHASE - QUALITY VERIFICATION
  // =============================================================================
  subgraph cluster_execution {
    label="Quality Verification Phase";
    style="filled,rounded";
    color="purple";
    bgcolor="#F0E8F8";

    code_analysis [label="Run Static Code Analysis\n(Linting, Type Checking)", fillcolor=purple];
    analysis_check [shape=diamond, label="Analysis\nPass?"];

    security_scan [label="Run Security Scan\n(Vulnerabilities, Secrets)", fillcolor=purple];
    security_check [shape=diamond, label="Security\nClear?"];

    test_execution [label="Execute Test Suite\n(Unit, Integration, E2E)", fillcolor=purple];
    test_check [shape=diamond, label="Tests\nPass?"];

    coverage_analysis [label="Analyze Code Coverage", fillcolor=purple];
    coverage_check [shape=diamond, label="Coverage\n>80%?"];

    // Error handling within execution
    analysis_error [shape=octagon, fillcolor=orange,
                    label="Code Analysis Failed"];
    security_error [shape=octagon, fillcolor=crimson,
                    label="CRITICAL\nSecurity Issues"];
    test_error [shape=octagon, fillcolor=orange,
                label="Test Failures"];
    retry_logic [label="Auto-Fix & Retry", fillcolor=yellow];
  }

  // Connect validation to execution
  validate_standards -> code_analysis [label="Defined"];

  // Execution flow
  code_analysis -> analysis_check;
  analysis_check -> security_scan [label="Yes"];
  analysis_check -> analysis_error [label="No"];

  security_scan -> security_check;
  security_check -> test_execution [label="Yes"];
  security_check -> security_error [label="No"];

  test_execution -> test_check;
  test_check -> coverage_analysis [label="Yes"];
  test_check -> test_error [label="No"];

  coverage_analysis -> coverage_check;
  coverage_check -> test_error [label="No"];

  // Error recovery
  analysis_error -> retry_logic;
  test_error -> retry_logic;
  retry_logic -> code_analysis [label="Retry", style=dashed];
  retry_logic -> escalate [label="Max Retries"];

  // Security errors escalate immediately
  security_error -> escalate;

  // =============================================================================
  // COORDINATION & MEMORY
  // =============================================================================
  subgraph cluster_coordination {
    label="Quality Tracking";
    style="filled,rounded";
    color="blue";
    bgcolor="#E8E8F8";

    memory_store [label="Store Quality Metrics\nin Memory", fillcolor=lightblue];
    track_trends [label="Track Quality Trends", fillcolor=lightblue];
    compare_baseline [label="Compare to Baseline", fillcolor=lightblue];
    check_regression [shape=diamond, label="Quality\nRegression?"];
    notify_coordinator [label="Notify\nCoordinator", fillcolor=lightblue];
  }

  // Connect execution to coordination
  coverage_check -> memory_store [label="Yes"];
  memory_store -> track_trends;
  track_trends -> compare_baseline;
  compare_baseline -> check_regression;
  check_regression -> notify_coordinator [label="No"];
  check_regression -> escalate [label="Yes"];

  // =============================================================================
  // VALIDATION & QUALITY GATES
  // =============================================================================
  subgraph cluster_quality {
    label="Final Quality Gates";
    style="filled,rounded";
    color="green";
    bgcolor="#E8F8E8";

    validate_all [shape=diamond, label="All Checks\nPassed?"];
    performance_check [label="Check Performance Metrics", fillcolor=lightgreen];
    perf_check [shape=diamond, label="Performance\nAcceptable?"];

    accessibility_check [label="Check Accessibility (A11y)", fillcolor=lightgreen];
    a11y_check [shape=diamond, label="A11y\nCompliant?"];

    quality_gate_fail [shape=octagon, fillcolor=orange,
                       label="Quality Gate Failed"];
  }

  // Connect coordination to quality
  notify_coordinator -> validate_all;

  // Quality flow
  validate_all -> performance_check [label="Yes"];
  validate_all -> quality_gate_fail [label="No"];

  performance_check -> perf_check;
  perf_check -> accessibility_check [label="Yes"];
  perf_check -> quality_gate_fail [label="No"];

  accessibility_check -> a11y_check;
  a11y_check -> quality_gate_fail [label="No"];

  // =============================================================================
  // COMPLETION & CLEANUP
  // =============================================================================
  subgraph cluster_completion {
    label="Completion";
    style="filled,rounded";
    color="green";
    bgcolor="#E8F8E8";

    generate_report [label="Generate Quality Report", fillcolor=lightgreen];
    update_badges [label="Update Quality Badges", fillcolor=lightgreen];
    cleanup [label="Cleanup Test Artifacts", fillcolor=lightgreen];
    log_completion [label="Log Verification Metrics"];
    success [label="Quality Verified", shape=doublecircle,
             fillcolor=green, style="filled,bold"];
  }

  // Connect quality to completion
  a11y_check -> generate_report [label="Yes"];
  generate_report -> update_badges;
  update_badges -> cleanup;
  cleanup -> log_completion;
  log_completion -> success;

  // =============================================================================
  // ERROR ESCALATION PATH
  // =============================================================================
  subgraph cluster_errors {
    label="Error Handling & Escalation";
    style="filled,rounded";
    color="red";
    bgcolor="#F8E8E8";

    escalate [shape=hexagon, fillcolor=yellow,
              label="Escalate to User"];
    log_error [label="Log Error Details", fillcolor=orange];
    create_issues [label="Create Issue Tickets", fillcolor=orange];
    failure [label="Verification Failed", shape=doublecircle,
             fillcolor=red, style="filled,bold"];
  }

  // Error escalation flow
  escalate -> log_error;
  quality_gate_fail -> log_error;
  policy_violation -> log_error;
  secrets_violation -> log_error;
  standards_missing -> log_error;

  log_error -> create_issues;
  create_issues -> failure;

  // =============================================================================
  // LEGEND
  // =============================================================================
  subgraph cluster_legend {
    label="Legend";
    rank=sink;
    style="filled,rounded";
    bgcolor="#F8F8F8";

    legend_start [shape=ellipse, label="Entry Point", fillcolor=lightblue];
    legend_decision [shape=diamond, label="Decision"];
    legend_process [shape=box, label="Process", fillcolor=purple];
    legend_block [shape=octagon, fillcolor=crimson, label="Blocker"];
    legend_warn [shape=octagon, fillcolor=orange, label="Warning"];
    legend_manual [shape=hexagon, fillcolor=yellow, label="Manual"];
    legend_success [shape=doublecircle, fillcolor=green, label="Success"];
    legend_failure [shape=doublecircle, fillcolor=red, label="Failure"];

    // Hide from main layout
    legend_start -> legend_decision [style=invis];
    legend_decision -> legend_process [style=invis];
    legend_process -> legend_block [style=invis];
    legend_block -> legend_warn [style=invis];
    legend_warn -> legend_manual [style=invis];
    legend_manual -> legend_success [style=invis];
    legend_success -> legend_failure [style=invis];
  }
}
