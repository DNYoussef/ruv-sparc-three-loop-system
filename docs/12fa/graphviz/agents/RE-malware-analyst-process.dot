digraph REMalwareAnalystAgent {
    rankdir=TB;
    node [shape=box, style="rounded,filled", fillcolor=lightblue];
    edge [color=darkblue, penwidth=2];

    // Agent definition
    start [label="RE-malware-analyst\nAgent Activated", fillcolor=lightgreen];

    // Static analysis
    static_analysis [label="Static Analysis\nPhase", fillcolor=lightyellow];
    extract_iocs [label="Extract IOCs\n(IPs, Domains, URLs)"];
    signature_scan [label="YARA Signature\nScanning"];
    detect_anti_analysis [label="Detect Anti-Analysis\nTechniques"];
    identify_persistence [label="Identify Persistence\nMechanisms"];
    analyze_capabilities [label="Analyze Malware\nCapabilities"];

    // Dynamic analysis
    dynamic_analysis [label="Dynamic Analysis\nPhase", fillcolor=lightyellow];
    setup_sandbox [label="Setup Sandbox\nEnvironment"];
    monitor_behavior [label="Monitor Runtime\nBehavior"];
    capture_network [label="Capture Network\nTraffic"];
    track_file_ops [label="Track File System\nOperations"];
    monitor_registry [label="Monitor Registry\nChanges"];
    log_api_calls [label="Log API/Syscalls"];

    // Threat intelligence
    threat_intel [label="Threat Intelligence\nCorrelation"];
    classify_family [label="Classify Malware\nFamily"];
    identify_c2 [label="Identify C2\nInfrastructure"];
    analyze_encryption [label="Analyze Encryption\n& Obfuscation"];

    // Integration
    memory_coordination [label="Store Findings in\nMemory MCP"];
    generate_report [label="Generate Malware\nAnalysis Report"];
    export_iocs [label="Export IOCs\n(STIX/OpenIOC)"];

    end [label="Malware Analysis\nComplete", fillcolor=lightcoral];

    // Flow - Static
    start -> static_analysis;
    static_analysis -> extract_iocs;
    extract_iocs -> signature_scan;
    signature_scan -> detect_anti_analysis;
    detect_anti_analysis -> identify_persistence;
    identify_persistence -> analyze_capabilities;

    // Flow - Dynamic
    analyze_capabilities -> dynamic_analysis;
    dynamic_analysis -> setup_sandbox;
    setup_sandbox -> monitor_behavior;
    monitor_behavior -> capture_network;
    capture_network -> track_file_ops;
    track_file_ops -> monitor_registry;
    monitor_registry -> log_api_calls;

    // Flow - Threat Intel
    log_api_calls -> threat_intel;
    threat_intel -> classify_family;
    classify_family -> identify_c2;
    identify_c2 -> analyze_encryption;

    // Flow - Output
    analyze_encryption -> memory_coordination;
    memory_coordination -> generate_report;
    generate_report -> export_iocs;
    export_iocs -> end;

    // Metadata
    label="RE-malware-analyst Agent Process Flow";
    fontsize=16;
    fontname="Arial Bold";
}
