digraph pptx_generation_workflow {
    // PowerPoint Generation Workflow
    // Using semantic shapes and readable quoted strings per GraphViz best practices
    // Reference: https://blog.fsck.com/2025/09/29/using-graphviz-for-claudemd/
    
    // Graph styling
    rankdir=TB;
    node [fontname="Arial", fontsize=10];
    edge [fontname="Arial", fontsize=9];
    
    // ========== ENTRY POINT ==========
    subgraph cluster_entry {
        label="Entry Point";
        style=filled;
        fillcolor=lightblue;
        
        "User requests presentation" [shape=ellipse, style=filled, fillcolor=lightgreen];
        "Analyze request complexity" [shape=diamond];
        "Simple deck (≤15 slides)?" [shape=diamond];
        "Complex deck (30+ slides)" [shape=ellipse, style=filled, fillcolor=orange];
        "Simple deck (≤15 slides)" [shape=ellipse, style=filled, fillcolor=lightgreen];
        
        "User requests presentation" -> "Analyze request complexity";
        "Analyze request complexity" -> "Simple deck (≤15 slides)?";
        "Simple deck (≤15 slides)?" -> "Simple deck (≤15 slides)" [label="yes"];
        "Simple deck (≤15 slides)?" -> "Complex deck (30+ slides)" [label="no"];
    }
    
    // ========== SIMPLE DECK WORKFLOW ==========
    subgraph cluster_simple {
        label="Simple Deck Workflow (Single Context)";
        style=filled;
        fillcolor=lightyellow;
        
        "Read simple-deck-template.md" [shape=box];
        "Gather all input files" [shape=box];
        "STOP: Enforce html2pptx workflow" [shape=octagon, style=filled, fillcolor=red, fontcolor=white];
        "List design restrictions" [shape=box];
        "Create pre-execution design plan" [shape=box];
        "Design plan addresses all restrictions?" [shape=diamond];
        "Revise design plan" [shape=box];
        "Generate all slides (single pass)" [shape=box];
        "Run validation checklist" [shape=box];
        "All validations pass?" [shape=diamond];
        "Identify failure mode" [shape=box];
        "Fix root cause (not symptom)" [shape=box];
        "Simple deck complete" [shape=doublecircle, style=filled, fillcolor=lightgreen];
        
        "Simple deck (≤15 slides)" -> "Read simple-deck-template.md";
        "Read simple-deck-template.md" -> "Gather all input files";
        "Gather all input files" -> "STOP: Enforce html2pptx workflow";
        "STOP: Enforce html2pptx workflow" -> "List design restrictions";
        "List design restrictions" -> "Create pre-execution design plan";
        "Create pre-execution design plan" -> "Design plan addresses all restrictions?";
        "Design plan addresses all restrictions?" -> "Revise design plan" [label="no"];
        "Design plan addresses all restrictions?" -> "Generate all slides (single pass)" [label="yes"];
        "Revise design plan" -> "Design plan addresses all restrictions?";
        "Generate all slides (single pass)" -> "Run validation checklist";
        "Run validation checklist" -> "All validations pass?";
        "All validations pass?" -> "Simple deck complete" [label="yes"];
        "All validations pass?" -> "Identify failure mode" [label="no"];
        "Identify failure mode" -> "Fix root cause (not symptom)";
        "Fix root cause (not symptom)" -> "Run validation checklist";
    }
    
    // ========== COMPLEX DECK WORKFLOW ==========
    subgraph cluster_complex {
        label="Complex Deck Workflow (Multi-Chat Architecture)";
        style=filled;
        fillcolor=lightcyan;
        
        "Read complex-deck-architecture.md" [shape=box];
        
        // Architect Chat
        "CHAT 1: Architect" [shape=box, style=bold, fillcolor=yellow];
        "Analyze all data sources" [shape=box];
        "Define narrative structure" [shape=box];
        "Create slide-level outline" [shape=box];
        "Generate master design plan" [shape=box];
        "Master design plan complete?" [shape=diamond];
        
        // Generator Chats
        "CHAT 2-N: Generators" [shape=box, style=bold, fillcolor=yellow];
        "Select next section (10-15 slides)" [shape=box];
        "Load master design plan" [shape=box];
        "STOP: Enforce html2pptx workflow" [shape=octagon, style=filled, fillcolor=red, fontcolor=white];
        "Generate section slides" [shape=box];
        "Validate section against design plan" [shape=box];
        "Section validates?" [shape=diamond];
        "Fix section issues" [shape=box];
        "More sections remaining?" [shape=diamond];
        
        // Assembly Chat
        "CHAT N+1: Assembly" [shape=box, style=bold, fillcolor=yellow];
        "Compile all sections" [shape=box];
        "Check visual consistency across deck" [shape=box];
        "Run full validation checklist" [shape=box];
        "Deck passes all validations?" [shape=diamond];
        "Identify inconsistent sections" [shape=box];
        "Regenerate specific sections only" [shape=box];
        "Complex deck complete" [shape=doublecircle, style=filled, fillcolor=lightgreen];
        
        "Complex deck (30+ slides)" -> "Read complex-deck-architecture.md";
        "Read complex-deck-architecture.md" -> "CHAT 1: Architect";
        "CHAT 1: Architect" -> "Analyze all data sources";
        "Analyze all data sources" -> "Define narrative structure";
        "Define narrative structure" -> "Create slide-level outline";
        "Create slide-level outline" -> "Generate master design plan";
        "Generate master design plan" -> "Master design plan complete?";
        "Master design plan complete?" -> "Generate master design plan" [label="no"];
        "Master design plan complete?" -> "CHAT 2-N: Generators" [label="yes"];
        
        "CHAT 2-N: Generators" -> "Select next section (10-15 slides)";
        "Select next section (10-15 slides)" -> "Load master design plan";
        "Load master design plan" -> "STOP: Enforce html2pptx workflow";
        "STOP: Enforce html2pptx workflow" -> "Generate section slides";
        "Generate section slides" -> "Validate section against design plan";
        "Validate section against design plan" -> "Section validates?";
        "Section validates?" -> "Fix section issues" [label="no"];
        "Section validates?" -> "More sections remaining?" [label="yes"];
        "Fix section issues" -> "Generate section slides";
        "More sections remaining?" -> "Select next section (10-15 slides)" [label="yes"];
        "More sections remaining?" -> "CHAT N+1: Assembly" [label="no"];
        
        "CHAT N+1: Assembly" -> "Compile all sections";
        "Compile all sections" -> "Check visual consistency across deck";
        "Check visual consistency across deck" -> "Run full validation checklist";
        "Run full validation checklist" -> "Deck passes all validations?";
        "Deck passes all validations?" -> "Complex deck complete" [label="yes"];
        "Deck passes all validations?" -> "Identify inconsistent sections" [label="no"];
        "Identify inconsistent sections" -> "Regenerate specific sections only";
        "Regenerate specific sections only" -> "Compile all sections";
    }
    
    // ========== VALIDATION SUBPROCESS ==========
    subgraph cluster_validation {
        label="Validation Checklist (Referenced from Multiple Points)";
        style=filled;
        fillcolor=lightgray;
        
        "CHECK: Contrast ratios ≥4.5:1" [shape=plaintext];
        "CHECK: Font sizes (18pt/24pt min)" [shape=plaintext];
        "CHECK: Margins ≥0.5 inches" [shape=plaintext];
        "CHECK: No border boxes/outlines" [shape=plaintext];
        "CHECK: Max 3 bullets per slide" [shape=plaintext];
        "CHECK: Thumbnail readability" [shape=plaintext];
        "CHECK: No overlapping elements" [shape=plaintext];
        "CHECK: Visual consistency" [shape=plaintext];
    }
    
    // ========== FAILURE MODES AND RECOVERY ==========
    subgraph cluster_failures {
        label="Common Failure Modes";
        style=filled;
        fillcolor=pink;
        
        "FAILURE: Inconsistent styling" [shape=octagon, style=filled, fillcolor=orange];
        "ROOT CAUSE: No design plan" [shape=box];
        "FIX: Create and reference design plan" [shape=box];
        
        "FAILURE: Text overlap/overflow" [shape=octagon, style=filled, fillcolor=orange];
        "ROOT CAUSE: Tool degradation" [shape=box];
        "FIX: Enforce html2pptx workflow" [shape=box];
        
        "FAILURE: Border boxes appear" [shape=octagon, style=filled, fillcolor=orange];
        "ROOT CAUSE: Weak negative constraints" [shape=box];
        "FIX: Lead with CAPITAL LETTER prohibitions" [shape=box];
        
        "FAILURE: Low contrast" [shape=octagon, style=filled, fillcolor=orange];
        "ROOT CAUSE: Skipped validation" [shape=box];
        "FIX: Make validation non-optional" [shape=box];
        
        "FAILURE: Context window exhausted" [shape=octagon, style=filled, fillcolor=orange];
        "ROOT CAUSE: Wrong architecture" [shape=box];
        "FIX: Use multi-chat for >15 slides" [shape=box];
    }
    
    // ========== ABSOLUTE WARNINGS ==========
    subgraph cluster_warnings {
        label="Absolute Prohibitions";
        style=filled;
        fillcolor=red;
        fontcolor=white;
        
        "NEVER: Use border boxes" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
        "NEVER: Use outline shapes" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
        "NEVER: Switch from html2pptx" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
        "NEVER: Skip design plan" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
        "NEVER: Generate all complex slides at once" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
        "NEVER: Fix symptoms without root cause" [shape=octagon, style=filled, fillcolor=darkred, fontcolor=white];
    }
    
    // Cross-references showing validation integration
    "Run validation checklist" -> "CHECK: Contrast ratios ≥4.5:1" [style=dotted, color=gray];
    "Run full validation checklist" -> "CHECK: Contrast ratios ≥4.5:1" [style=dotted, color=gray];
    
    // Failure mode references
    "Identify failure mode" -> "FAILURE: Inconsistent styling" [style=dotted, color=red];
    "Identify failure mode" -> "FAILURE: Text overlap/overflow" [style=dotted, color=red];
    "Identify failure mode" -> "FAILURE: Border boxes appear" [style=dotted, color=red];
    "Identify failure mode" -> "FAILURE: Low contrast" [style=dotted, color=red];
}
