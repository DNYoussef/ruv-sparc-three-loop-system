digraph IntentAnalyzer {
    rankdir=TB;
    node [shape=box, style="rounded,filled", fillcolor=lightblue, fontname="Arial"];
    edge [fontname="Arial"];

    start [label="Start: User Request", fillcolor=lightgreen];

    // Core Principles
    principles [label="Core Principles", fillcolor=lightyellow, shape=folder];
    p1 [label="First Principles\nDecomposition\n• Break to fundamental goals"];
    p2 [label="Probabilistic Intent\nMapping\n• Multiple interpretations"];
    p3 [label="Evidence-Based Pattern\nRecognition"];
    p4 [label="Constraint Detection\n• Explicit & implicit"];
    p5 [label="Socratic Clarification\n• Strategic questions"];

    // Phase 1: Deep Analysis
    phase1 [label="Phase 1:\nDeep Analysis (Internal)", fillcolor=lightcyan];
    pa_archaeology [label="Intent Archaeology\n• Explicit vs implied\n• Domain knowledge\n• Expertise level"];
    pa_extrapolate [label="Goal Extrapolation\n• Immediate goals\n• Higher-order goals"];
    pa_constraints [label="Constraint Detection\n• Stated requirements\n• Contextual constraints"];
    pa_pattern [label="Pattern Recognition\n• Analytical/Creative\n• Technical/Learning"];
    pa_ambiguity [label="Ambiguity Assessment\n• High (>80%)\n• Moderate (50-80%)\n• Low (<50%)"];

    // Decision Point
    decision [label="Confidence Level?", shape=diamond, fillcolor=yellow];

    // Path A: High Confidence
    pathA [label="Path A:\nHigh Confidence (>80%)", fillcolor=lightgreen];
    pa_proceed [label="Proceed Directly\n• Note interpretation\n• Remain open to correction"];

    // Path B: Clarification Required
    pathB [label="Path B:\nClarification Required", fillcolor=lightsalmon];
    pb_disambig [label="Disambiguation\nQuestions\n• Choice between\ninterpretations"];
    pb_constraint [label="Constraint Revelation\nQuestions\n• What/who/timeline"];
    pb_context [label="Context Gathering\nQuestions\n• Broader context"];
    pb_assumption [label="Assumption Validation\nQuestions"];

    // Phase 3: Socratic Clarification
    phase3 [label="Phase 3:\nSocratic Clarification", fillcolor=lightyellow];
    p3_questions [label="Ask 1-3 Strategic\nQuestions\n• Focused & efficient"];

    // Phase 4: Reconstruction
    phase4 [label="Phase 4:\nInterpretation Reconstruction", fillcolor=lightyellow];
    pr_synthesize [label="Intent Synthesis\n• Combine explicit +\nimplicit goals"];
    pr_surface [label="Assumption Surfacing\n• Make explicit"];
    pr_signal [label="Approach Signaling\n• Indicate method"];

    // Pattern Recognition
    patterns [label="Pattern-Based Intent\nRecognition", shape=cylinder, fillcolor=lightcoral];
    pt_creative [label="Creative Requests\n• Write/Create/Design"];
    pt_analytical [label="Analytical Requests\n• Analyze/Evaluate"];
    pt_technical [label="Technical Requests\n• Fix/Debug/Build"];
    pt_learning [label="Learning Requests\n• Explain/Teach"];
    pt_decision [label="Decision Requests\n• Should I/Which"];

    output [label="Output: Clear Understanding\n+ Appropriate Response", fillcolor=lightgreen];

    // Flow
    start -> principles;
    principles -> p1 -> p2 -> p3 -> p4 -> p5;
    p5 -> phase1;

    phase1 -> pa_archaeology -> pa_extrapolate -> pa_constraints;
    pa_constraints -> pa_pattern -> pa_ambiguity;
    pa_ambiguity -> decision;

    decision -> pathA [label=">80%"];
    decision -> pathB [label="<80%"];

    pathA -> pa_proceed -> phase4;

    pathB -> phase3;
    phase3 -> pb_disambig;
    phase3 -> pb_constraint;
    phase3 -> pb_context;
    phase3 -> pb_assumption;

    pb_disambig -> p3_questions;
    pb_constraint -> p3_questions;
    pb_context -> p3_questions;
    pb_assumption -> p3_questions;

    p3_questions -> phase4;

    phase4 -> pr_synthesize -> pr_surface -> pr_signal;
    pr_signal -> output;

    // Pattern references
    pa_pattern -> patterns [style=dashed, label="uses"];
    patterns -> pt_creative;
    patterns -> pt_analytical;
    patterns -> pt_technical;
    patterns -> pt_learning;
    patterns -> pt_decision;

    // Reference file
    ref [label="Intent Patterns\nReference", shape=cylinder, fillcolor=lightcoral];
    patterns -> ref [style=dotted];

    // Labels
    labelloc="t";
    label="Intent Analyzer: 4-Phase Deep Understanding Process";
    fontsize=16;
    fontname="Arial Bold";
}
