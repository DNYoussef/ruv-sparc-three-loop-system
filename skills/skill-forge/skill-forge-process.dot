digraph SkillForge {
    rankdir=TB;
    compound=true;
    node [shape=box, style=filled, fontname="Arial"];
    edge [fontname="Arial"];

    // Start and end points
    start [shape=ellipse, label="Start:\nSkill Creation\nRequest", fillcolor=lightgreen];
    end [shape=ellipse, label="Complete:\nProduction-Ready\nSkill", fillcolor=green, fontcolor=white];

    // Phase 1: Intent Archaeology
    subgraph cluster_phase1 {
        label="Phase 1: Intent Archaeology";
        fillcolor=lightyellow;
        style=filled;

        p1_deep [label="Conduct Deep\nAnalysis"];
        p1_assumptions [label="Identify Hidden\nAssumptions"];
        p1_map [label="Map Problem\nSpace"];
        p1_clarify [shape=diamond, label="Clarification\nNeeded?", fillcolor=yellow];
        p1_doc [label="Document Core\nUnderstanding"];

        p1_deep -> p1_assumptions -> p1_map -> p1_clarify;
        p1_clarify -> p1_doc [label="no"];
    }

    // Phase 2: Use Case Crystallization
    subgraph cluster_phase2 {
        label="Phase 2: Use Case Crystallization";
        fillcolor=lightyellow;
        style=filled;

        p2_examples [label="Generate 3-5\nRepresentative\nExamples"];
        p2_validate [label="Validate Examples"];
        p2_patterns [label="Identify Pattern\nVariations"];
        p2_coverage [label="Establish Coverage"];

        p2_examples -> p2_validate -> p2_patterns -> p2_coverage;
    }

    // Phase 3: Structural Architecture
    subgraph cluster_phase3 {
        label="Phase 3: Structural Architecture";
        fillcolor=lightyellow;
        style=filled;

        p3_progressive [label="Apply Progressive\nDisclosure"];
        p3_resources [label="Identify Resource\nRequirements"];
        p3_structure [label="Structure SKILL.md\nContent"];
        p3_prompting [label="Apply Prompting\nPrinciples"];

        p3_progressive -> p3_resources -> p3_structure -> p3_prompting;
    }

    // Phase 4: Metadata Engineering
    subgraph cluster_phase4 {
        label="Phase 4: Metadata Engineering";
        fillcolor=lightyellow;
        style=filled;

        p4_name [label="Choose Strategic\nName"];
        p4_description [label="Engineer\nDescription"];
        p4_triggers [label="Incorporate\nTrigger Patterns"];

        p4_name -> p4_description -> p4_triggers;
    }

    // Phase 5: Instruction Crafting
    subgraph cluster_phase5 {
        label="Phase 5: Instruction Crafting";
        fillcolor=lightyellow;
        style=filled;

        p5_imperative [label="Adopt Imperative\nVoice"];
        p5_procedural [label="Provide Procedural\nClarity"];
        p5_quality [label="Build Quality\nMechanisms"];
        p5_failure [label="Address Failure\nModes"];

        p5_imperative -> p5_procedural -> p5_quality -> p5_failure;
    }

    // Phase 6: Resource Development
    subgraph cluster_phase6 {
        label="Phase 6: Resource Development";
        fillcolor=lightyellow;
        style=filled;

        p6_scripts [label="Develop Scripts"];
        p6_refs [label="Compile\nReferences"];
        p6_assets [label="Curate Assets"];
        p6_graphviz [label="Create GraphViz\nDiagram"];

        p6_scripts -> p6_refs -> p6_assets -> p6_graphviz;
    }

    // Phase 7: Validation
    subgraph cluster_phase7 {
        label="Phase 7: Validation & Iteration";
        fillcolor=lightyellow;
        style=filled;

        p7_validate [label="Run Validation"];
        p7_test [label="Test Functionality"];
        p7_antipatterns [shape=diamond, label="Anti-patterns\nFound?", fillcolor=yellow];
        p7_iterate [shape=octagon, label="ITERATE:\nRefine Based on\nFeedback", fillcolor=orange];
        p7_package [label="Package for\nDistribution"];

        p7_validate -> p7_test -> p7_antipatterns;
        p7_antipatterns -> p7_iterate [label="yes", color=red];
        p7_antipatterns -> p7_package [label="no", color=green];
    }

    // External skill references
    intentanalyze [shape=cylinder, label="intent-analyzer\n(Deep intent analysis)", fillcolor=lightcoral];
    promptarch [shape=cylinder, label="prompt-architect\n(Evidence-based\ntechniques)", fillcolor=lightcoral];

    // Main flow
    start -> p1_deep;
    p1_clarify -> start [label="yes:\nclarify", style=dashed, color=red];
    p1_doc -> p2_examples;
    p2_coverage -> p3_progressive;
    p3_prompting -> p4_name;
    p4_triggers -> p5_imperative;
    p5_failure -> p6_scripts;
    p6_graphviz -> p7_validate;
    p7_iterate -> p1_deep [style=dashed, label="revise", color=red];
    p7_package -> end;

    // Cross-references
    p1_deep -> intentanalyze [style=dashed, label="uses", color=blue];
    p3_prompting -> promptarch [style=dashed, label="applies", color=blue];
    p5_quality -> promptarch [style=dashed, label="applies", color=blue];

    labelloc="t";
    label="Skill Forge: 7-Phase Skill Creation Process";
    fontsize=16;
    fontname="Arial Bold";
}
